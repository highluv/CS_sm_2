@startuml
start

:В main выбран пункт "Load from file";
:Считать filename;

:Вызов resetContacts();
note right
resetContacts очищает массив contacts[]
и сбрасывает contactsCount = 0.
Это гарантирует, что загрузка
начинает заполнять массив "с нуля".
end note

:Вызов loadFromFile(filename);

if (Не удалось открыть файл?) then (да)
  :Вывести "Cannot open file!";
  :return false в main;
  stop
endif

while (std::getline(file, line))
  :Создать std::stringstream ss(line);
  :Создать локальный Contact c;

  :Прочитать field до ';' → c.id (stoi);
  :Прочитать до ';' → c.name;
  :Прочитать до ';' → c.phone;
  :Прочитать до ';' → c.category;
  :Прочитать до ';' → c.birthday;
  :Прочитать до ';' → age (stoi);
  :Прочитать до ';' → deleted ("1" → true);

  :contacts[contactsCount] = c;
  :contactsCount++;
endwhile

:Закрыть file;
:return true в main;

note right
Сразу после успешной загрузки main
вызывает:
  idIndex = BinaryTreeIndex();
  buildIdIndex(idIndex);
Тем самым индекс по ID
автоматически пересобирается
по новым данным.
end note

stop
@enduml
